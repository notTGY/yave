M=[];with(Math){for(a=I=255;I--;)for(J=a;J--;M.push([I,0,J]))if(random()>.7)M.push([I,1,J]);S=sin;C=cos;F=e=>2*asin(1-e/125)};x=c.getContext`2d`;P=x.createImageData(c.width=c.height=X=Z=H=80,H);Q=P.data;for(b=N=H*H;N--;Y=3)Q[N*4+3]=a;G=e=>new Date().getTime();(onmousemove=e=>{i=C(A=-2.5*F(e.x));j=S(A);k=C(B=F(e.y));l=S(B)})({x:L=0,y:0});(U=e=>{E=G();V=M[g='filter'](([I,J,e])=>(h=I-X)**2+(m=J-Y)**2+(n=e-Z)**2<60&&(t=h*j*k+m*l+n*i*k)>1&&(h-t*j*k)**2+(m-t*l)**2+(n-t*i*k)**2<4*t*t);for(N=b;N--;Q[N*4]=Q[N*4+1]=Q[N*4+2]=K){d=2*(N%H)/H-1;f=2*N/b-1;T=k+f*l;o=d*i+j*T;q=i*T-d*j;p=l-f*k;W=V[g](([I,J,e])=>((h=I-X)-(B=h*o+(m=J-Y)*p+(n=e-Z)*q)*o)**2+(m-B*p)**2+(n-B*q)**2<2*B*B);K=a;for(D=1;D<9;D+=.2)W[g](O=>((I,J,e)=>I<.5&&J<.5&&e<.5&&I>-.5&&J>-.5&&e>-.5&&(K=20*++D)&&(D=9))(O[0]-X-o*D,O[1]-Y-p*D,O[2]-Z-q*D))}x.putImageData(P,0,0);if(L--)T=(G()-E)/a,Z+=T*C(L=A+1.6*L),X+=T*S(L);setTimeout(U,L=0)})(onkeydown=e=>L={w:1,s:3,a:4,d:2}[e.key])
