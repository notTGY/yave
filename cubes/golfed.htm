<canvas id=c style="width:500;height:500;border:1px solid"><body onload="with(Math){for(M=[],a=I=255;I--;Y=3)for(J=a;J--;S=sin)M.push([I,0,J],[I,1,J,1]);for(F=t=>2*asin(1-t/a),x=c.getContext`2d`,P=x.createImageData(c.width=c.height=X=Z=H=80,H),Q=P.data,b=N=H*H;N--;C=cos)Q[4*N+3]=a;(onmousemove=t=>{i=C(A=-2.5*F(t.x)),j=S(A),k=C(B=F(t.y)),l=S(B)})({x:0,y:L=0}),G=Date.now,oncontextmenu=onclick=t=>t.preventDefault()^t.which-3?M.splice(r,1):(o=M[r],M.push([o[0],o[1]+1,o[2]]))}(U=e=>{for(E=G(V=M[g='filter']((([o,e,a])=>(h=o-X)*h+(m=e-Y)*m+(n=a-Z)*n<60&&(t=h*j*k+m*l+n*i*k)>1&&(h-t*j*k)**2+(m-t*l)**2+(n-t*i*k)**2<4*t*t))),N=b;N--;Q[p+2]=T?s?0:K/2:K){for(d=N%H*2/H-1,f=2*N/b-1,T=k+f*l,o=d*i+j*T,q=i*T-d*j,p=l-f*k,W=V[g]((([t,e,a])=>((h=t-X)-(B=h*o+(m=e-Y)*p+(n=a-Z)*q)*o)**2+(m-B*p)**2+(n-B*q)**2<2*B*B)),K=a,T=s=0,D=1;D<9;D+=.2)W[g]((t=>((t,o,e,a)=>t<.5&&o<.5&&e<.5&&t>-.5&&o>-.5&&e>-.5?(s=o<0,K=20*++D|0,T=N==3240?3:a[3],D=9):0)(t[0]-X-o*D,t[1]-Y-p*D,t[2]-Z-q*D,t)))[g]((t=>N==(b+H)/2?r=M.indexOf(t):0));Q[p=4*N]=T&&s?0:K,Q[p+1]=T&&!s?K/2:K}T=(G(x.putImageData(P,0,0))-E)/a,L>4?Y+=(5.5-L)*T:L--&&(Z+=T*C(L=A+1.6*L),X+=T*S(L)),setTimeout(U,L=0)})(onkeydown=t=>L={w:1,s:3,a:4,d:2,' ':5,Shift:6}[t.key])">
